Li\_2021\_ScalableMultilayer
Title:: A scalable multi-layer PBFT consensus for blockchain
Citekey:: Li\_2021\_ScalableMultilayer
Author:: Wenyu Li; Chenglin Feng; Lei Zhang; Hao Xu; Bin Cao; Muhammad Ali Imran
Date:: 2021-05-01
Journal:: IEEE Transactions on Parallel and Distributed Systems
Tags:: #PBFT  #多层共识 #其他共识优化 
File:: [Li 等\_2021\_A Scalable Multi-Layer PBFT Consensus for Blockchain.pdf](zotero://open-pdf/0_JVZW7BN7)
Work:: 提出一种可扩展的多层PBFT共识机制，通过将节点层次化分组，限制组内通信，以解决PBFT在大规模系统中节点扩展性差的问题
## 研究背景
区块链技术的共识机制对分布式系统的性能有着重要影响，特别是在交易吞吐量、延迟、节点扩展性和安全性方面。传统的工作量证明（PoW）机制因其资源消耗高、交易确认延迟长等问题，限制了其在需要高吞吐量和低延迟的应用场景中的使用。相较之下，实用拜占庭容错（PBFT）机制因其低复杂度和低能耗，被认为更适合在私有和联盟区块链中使用。然而，PBFT机制在节点扩展性方面存在瓶颈，难以在大型系统（如物联网生态系统）中应用。
## 研究目的
本文旨在提出一种可扩展的多层PBFT共识机制，通过将节点层次化分组，限制组内通信，以解决PBFT在大规模系统中节点扩展性差的问题。研究目标是优化双层和多层PBFT系统的通信复杂度，并通过理论分析和仿真验证其有效性。
## 研究技术
研究采用的主要技术包括：
1.  **双层PBFT模型**：提出了一种双层PBFT模型，通过分析通信复杂度和安全阈值，证明在节点均匀分布的情况下，通信复杂度可以显著降低。
2.  **安全性分析**：基于故障概率确定（FPD）模型和故障数量确定（FND）模型，分析双层PBFT系统的安全性。
3.  **协议设计**：为双层PBFT系统提供了一个实际可行的协议，并将研究结果推广到任意层数的PBFT系统。
## 研究内容
### 共识节点选择方法
#### **分层模型设计**
![\<img alt="" data-attachment-key="9LDAPXD5" data-annotation="%7B%22attachmentURI%22%3A%22http%3A%2F%2Fzotero.org%2Fusers%2F10122808%2Fitems%2FJVZW7BN7%22%2C%22annotationKey%22%3A%22C458F9F7%22%2C%22color%22%3A%22%23ffd400%22%2C%22pageLabel%22%3A%221147%22%2C%22position%22%3A%7B%22pageIndex%22%3A1%2C%22rects%22%3A%5B%5B304.256%2C562.676%2C518.519%2C730.547%5D%5D%7D%2C%22citationItem%22%3A%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F10122808%2Fitems%2FD4Z5EH2D%22%5D%2C%22locator%22%3A%221147%22%7D%7D" width="357" height="280" src="05-附件/9LDAPXD5.png" ztype="zimage">](05-附件/9LDAPXD5.png)\
<span class="citation" data-citation="%7B%22citationItems%22%3A%5B%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F10122808%2Fitems%2FD4Z5EH2D%22%5D%2C%22locator%22%3A%221147%22%7D%5D%2C%22properties%22%3A%7B%7D%7D" ztype="zcitation">(<span class="citation-item"><a href="zotero://select/library/items/D4Z5EH2D">Li 等, 2021, p. 1147</a></span>)</span>
将节点分为两层：
**第一层（上层）**：由若干主节点（Primary Nodes）和副本节点（Replica Nodes）组成。第一层的主节点负责协调整个系统的共识过程。
**第二层（下层）**：每个第一层的副本节点作为第二层的小组主节点（Group Leader），每个小组包含若干次级节点（Sub-Nodes），这些节点在其所在的小组内进行共识。
#### 具体步骤
*   **节点初始化和分组**：
    *   在网络初始化时，所有节点被分配到第一层和第二层。
    *   第一层包含一个主节点和若干副本节点。
    *   每个第一层的副本节点将作为第二层的主节点，管理若干次级节点。
*   **第一层的工作机制**：
    *   第一层的主节点接收到客户端的请求后，会生成一个交易并将其广播给所有副本节点。
    *   副本节点收到交易后进行验证，并进行“预准备（Pre-Prepare）”和“准备（Prepare）”阶段的共识消息传递。
    *   当收集到足够数量的准备消息（即超过2f，其中f为容错节点数）后，副本节点进入“提交（Commit）”阶段。
    *   副本节点确认提交后，将进入第二层的小组内进行进一步的共识。
*   **第二层的工作机制**：
    *   在第二层，每个小组的主节点（即第一层的副本节点）会将收到的交易广播给其管理的次级节点。
    *   次级节点在小组内进行“预准备”、“准备”和“提交”阶段的共识消息传递，与第一层类似。
    *   当次级节点达成共识并完成提交后，会将结果返回给小组主节点。
*   **结果汇总和反馈**：
    *   每个小组主节点将第二层次级节点的共识结果汇总，并反馈给第一层的主节点。
    *   第一层的主节点根据汇总结果，形成最终的共识结果并返回给客户端。
#### 双层模型的优势
1.  **降低通信复杂度**：通过限制第一层和第二层组内的通信，将原本单层PBFT的O(N^2)通信复杂度降低为双层结构下的O(m^2 + mn^2)，其中m是第一层的节点数，n是每个小组的次级节点数。
2.  **提高系统扩展性**：双层结构允许系统中包含更多节点，而不会显著增加通信负担，使得PBFT机制可以应用于更大规模的物联网和其他分布式系统中。
3.  **提高容错能力**：在双层结构下，系统可以更好地容忍节点故障，通过分组共识和层间协调，确保系统在高故障率下仍能保持稳定运行。
### 领导节点选择方法
1.  **第一层主节点选择**：采用PBFT协议，通过多轮消息传递和投票选举第一层的主节点。
2.  **视图变化机制**：当检测到主节点失效时，通过视图变化机制（view change），由备选节点接替主节点角色，确保系统的连续性和稳定性。
3.  **双层领导节点协调**：在双层结构中，第一层的领导节点负责与第二层节点的通信和协调，通过双层协议确保整体系统的共识达成。
## 实验结果
1.  **通信复杂度降低**：双层PBFT系统的通信复杂度相比传统单层PBFT系统显著降低。在节点数量为1000时，通信复杂度从10^6减少到2×10^4。
2.  **安全性能提高**：双层PBFT系统在故障概率和故障数量确定模型下的安全性能得到了验证，证明在节点均匀分布的情况下系统能够容忍更多的故障节点。
3.  **协议有效性**：设计的双层PBFT协议在仿真中表现出较好的性能和稳定性，证明了其在大规模系统中的可行性。
## 未来与展望
1.  **多层PBFT系统的优化**：进一步优化多层PBFT系统的通信复杂度和安全性能，探索更高层次的系统设计。
2.  **实际应用场景验证**：在实际物联网和其他分布式系统中验证提出的多层PBFT机制，评估其在真实环境中的性能和稳定性。
3.  **协议改进**：基于仿真和实际应用中的反馈，不断改进和优化双层和多层PBFT协议，提高其在不同应用场景中的适应性和鲁棒性。
